<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WebSocket Chat</title>
    <style>
        body {
            background: #f4f6fb;
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 420px;
            margin: 40px auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            padding: 32px 24px 24px 24px;
        }
        h1 {
            text-align: center;
            color: #2d3a4b;
            margin-bottom: 10px;
        }
        .room-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 18px;
            justify-content: center;
        }
        .room-controls input {
            padding: 6px 10px;
            border: 1px solid #cfd8dc;
            border-radius: 6px;
            font-size: 1em;
            width: 90px;
        }
        .room-controls button {
            padding: 6px 14px;
            border: none;
            border-radius: 6px;
            background: #1976d2;
            color: #fff;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        .room-controls button:last-child {
            background: #e53935;
        }
        .room-controls button:hover {
            opacity: 0.9;
        }
        form {
            display: flex;
            gap: 8px;
            margin-bottom: 18px;
        }
        #messageText {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #cfd8dc;
            border-radius: 6px;
            font-size: 1em;
        }
        form button {
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            background: #388e3c;
            color: #fff;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        form button:hover {
            background: #2e7031;
        }
        #messages {
            list-style: none;
            padding: 0;
            margin: 0 0 18px 0;
            max-height: 260px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafbfc;
        }
        #messages li {
            padding: 7px 12px;
            margin: 2px 0;
            border-radius: 6px;
            word-break: break-word;
        }
        #messages li:nth-child(odd) {
            background: #f1f8ff;
        }
        #messages li:nth-child(even) {
            background: #e3f2fd;
        }
        #messages li[style*="color: gray"] {
            background: #f5f5f5 !important;
            color: #757575 !important;
            font-style: italic;
        }
        .images {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 18px;
        }
        .images img {
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            width: 120px;
            height: auto;
            object-fit: cover;
        }
        a {
            color: #1976d2;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>WebSocket Chat</h1>
        <h1><a href='https://bytecraft.com.ua'>Bytecraft</a></h1>
        <div class="room-controls">
            <label>Room: <input id="roomInput" value="main" /></label>
            <button onclick="connect()">Підключитися</button>
            <button onclick="leaveRoom()">Вийти</button>
        </div>
        <form onsubmit="sendMessage(event)">
            <input type="text" id="messageText" autocomplete="off" placeholder="Type your message..." />
            <button>Відправити</button>
        </form>
        <ul id="messages"></ul>
        <div class="images">
            <img src="https://res2.weblium.site/res/683deb0bde7b8dfb78b055e5/6873aab3ccd53279455bfb44_optimized_953_c953x953-0x0.webp" alt="Фото"/>
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQiHPN_CyosGu2C0kDyVFwyrQoFuQBiFMn9gQ&s" alt="Фото"/>
        </div>
    </div>
<script>
    let ws = null;
    let connected = false;
    let leaving = false;
    let currentRoom = null;

    function connect() {
        if (connected) {
            appendSystem("Уже підключено.");
            return;
        }

        currentRoom = document.getElementById("roomInput").value;
        ws = new WebSocket(`ws://127.0.0.1:8000/ws/${currentRoom}`);

        ws.onopen = () => {
            connected = true;
            appendSystem("Підключено до кіманти " + currentRoom);
        };

        ws.onmessage = (e) => {
            appendMessage(e.data);
            if (leaving) {
                ws.close();
                leaving = false;
            }
        };

        ws.onclose = () => {
            connected = false;
            appendSystem("Відключено від кімнати " + currentRoom);
        };
    }

    function sendMessage(e) {
        e.preventDefault();
        const input = document.getElementById("messageText");
        if (ws && ws.readyState === WebSocket.OPEN) {
            ws.send(input.value);
            input.value = '';
        }
    }

    function leaveRoom() {
        if (ws && ws.readyState === WebSocket.OPEN) {
            ws.close();
            connected = false;  
        }
    }


    function appendMessage(text) {
        const li = document.createElement('li');
        li.textContent = text;
        document.getElementById("messages").appendChild(li);
        scrollMessages();
    }

    function appendSystem(text) {
        const li = document.createElement('li');
        li.style.color = "gray";
        li.textContent = text;
        document.getElementById("messages").appendChild(li);
        scrollMessages();
    }

    function scrollMessages() {
        const messages = document.getElementById("messages");
        messages.scrollTop = messages.scrollHeight;
    }
</script>
</body>
</html>